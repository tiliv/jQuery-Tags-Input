(function(a){var j=[],f=[];a.fn.doAutosize=function(b){var c=a(this).data("minwidth"),e=a(this).data("maxwidth"),d="",g=a(this),h=a("#"+a(this).data("tester_id"));if(d!==(d=g.val()))d=d.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;"),h.html(d),h=h.width(),b=h+b.comfortZone>=c?h+b.comfortZone:c,h=g.width(),(b<h&&b>=c||b>c&&b<e)&&g.width(b)};a.fn.resetAutosize=function(b){var c=a(this).data("minwidth")||b.minInputWidth||a(this).width();b=a(this).data("maxwidth")||
b.maxInputWidth||a(this).closest(".tagsinput").width()-b.inputPadding;var e=a(this),d=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),fontWeight:e.css("fontWeight"),letterSpacing:e.css("letterSpacing"),whiteSpace:"nowrap"}),g=a(this).attr("id")+"_autosize_tester";0<!a("#"+g).length&&(d.attr("id",g),d.appendTo("body"));e.data("minwidth",c);e.data("maxwidth",b);e.data("tester_id",g);e.css("width",c)};a.fn.addTag=function(b,
c){c=jQuery.extend({focus:!1,callback:!0},c);this.each(function(){var e=a(this).attr("id"),d=a(this).val().split(j[e]);""==d[0]&&(d=[]);b=jQuery.trim(b);if(c.unique){var g=a(this).tagExist(b);!0==g&&a("#"+e+"_tag").addClass("not_valid")}else g=!1;if(""!=b&&!0!=g&&(a("<span>").addClass("tag").append(a("<span>").text(b),a("<a>",{href:"#",title:"Removing tag",text:a("#"+this.id+"_tagsinput").data("removeText")}).click(function(){return a("#"+e).removeTag(escape(b))})).insertBefore("#"+e+"_addTag"),d.push(b),
a("#"+e+"_tag").val(""),c.focus?a("#"+e+"_tag").focus():a("#"+e+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,d),c.callback&&(f[e]&&f[e].onAddTag)&&(g=f[e].onAddTag,g.call(this,b)),f[e]&&f[e].onChange)){var h=d.length,g=f[e].onChange;g.call(this,a(this),d[h-1])}});return!1};a.fn.removeTag=function(b){b=unescape(b);this.each(function(){var c=a(this).attr("id"),e=a(this).val().split(j[c]);a("#"+c+"_tagsinput .tag").remove();str="";for(i=0;i<e.length;i++)e[i]!=b&&(str=str+j[c]+e[i]);a.fn.tagsInput.importTags(this,
str);f[c]&&f[c].onRemoveTag&&f[c].onRemoveTag.call(this,b)});return!1};a.fn.tagExist=function(b){var c=a(this).attr("id"),c=a(this).val().split(j[c]);return 0<=jQuery.inArray(b,c)};a.fn.importTags=function(b){id=a(this).attr("id");a("#"+id+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,b)};a.fn.tagsInput=function(b){var c=jQuery.extend({interactive:!0,defaultText:"add a tag",removeText:"x",minChars:0,autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,
placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},b);this.each(function(){c.hide&&a(this).hide();var e=a(this).attr("id");if(!e||j[a(this).attr("id")])e=a(this).attr("id","tags"+(new Date).getTime()).attr("id");var d=jQuery.extend({pid:e,real_input:"#"+e,holder:"#"+e+"_tagsinput",input_wrapper:"#"+e+"_addTag",fake_input:"#"+e+"_tag"},c);j[e]=d.delimiter;if(c.onAddTag||c.onRemoveTag||c.onChange)f[e]=[],f[e].onAddTag=c.onAddTag,f[e].onRemoveTag=c.onRemoveTag,f[e].onChange=c.onChange;
var b='<div id="'+e+'_tagsinput" class="tagsinput"><div id="'+e+'_addTag">';c.interactive&&(b=b+'<input id="'+e+'_tag" value="" data-default="'+c.defaultText+'" />');b=a(b+'</div><div class="tags_clear"></div></div>');b.insertAfter(this);b=b.filter(".tagsinput");b.data("removeText",c.removeText);console.log([b[0],b.data()]);a(d.holder).css("width",c.width);a(d.holder).css("min-height",c.height);a(d.holder).css("height","100%");""!=a(d.real_input).val()&&a.fn.tagsInput.importTags(a(d.real_input),a(d.real_input).val());
if(c.interactive){a(d.fake_input).val(a(d.fake_input).attr("data-default"));a(d.fake_input).css("color",c.placeholderColor);a(d.fake_input).resetAutosize(c);a(d.holder).bind("click",d,function(c){a(c.data.fake_input).focus()});a(d.fake_input).bind("focus",d,function(c){a(c.data.fake_input).val()==a(c.data.fake_input).attr("data-default")&&a(c.data.fake_input).val("");a(c.data.fake_input).css("color","#000000")});if(void 0!=c.autocomplete_url){autocomplete_options={source:c.autocomplete_url};for(attrname in c.autocomplete)autocomplete_options[attrname]=
c.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(d.fake_input).autocomplete(c.autocomplete_url,c.autocomplete),a(d.fake_input).bind("result",d,function(b,d){d&&a("#"+e).addTag(d[0]+"",{focus:!0,unique:c.unique})})):void 0!==jQuery.ui.autocomplete&&(a(d.fake_input).autocomplete(autocomplete_options),a(d.fake_input).bind("autocompleteselect",d,function(b,d){a(b.data.real_input).addTag(d.item.value,{focus:!0,unique:c.unique});return!1}))}else a(d.fake_input).bind("blur",d,function(b){var d=
a(this).attr("data-default");""!=a(b.data.fake_input).val()&&a(b.data.fake_input).val()!=d?b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:c.unique}):(a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default")),a(b.data.fake_input).css("color",c.placeholderColor));return!1});a(d.fake_input).bind("keypress",d,function(b){if(b.which==b.data.delimiter.charCodeAt(0)||
13==b.which)return b.preventDefault(),b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:c.unique}),a(b.data.fake_input).resetAutosize(c),!1;b.data.autosize&&a(b.data.fake_input).doAutosize(c)});d.removeWithBackspace&&a(d.fake_input).bind("keydown",function(b){if(8==b.keyCode&&""==a(this).val()){b.preventDefault();b=a(this).closest(".tagsinput").find(".tag:last span").text();
var c=a(this).attr("id").replace(/_tag$/,"");a("#"+c).removeTag(escape(b));a(this).trigger("focus")}});a(d.fake_input).blur();d.unique&&a(d.fake_input).keydown(function(b){(8==b.keyCode||String.fromCharCode(b.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,/]+/))&&a(this).removeClass("not_valid")})}});return this};a.fn.tagsInput.updateTagsField=function(b,c){var e=a(b).attr("id");a(b).val(c.join(j[e]))};a.fn.tagsInput.importTags=function(b,c){a(b).val("");
var e=a(b).attr("id"),d=c.split(j[e]);for(i=0;i<d.length;i++)a(b).addTag(d[i],{focus:!1,callback:!1});f[e]&&f[e].onChange&&f[e].onChange.call(b,b,d[i])}})(jQuery);

